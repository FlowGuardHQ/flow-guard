{
  "contractName": "AirdropCovenant",
  "constructorInputs": [
    {
      "name": "vaultId",
      "type": "bytes32"
    },
    {
      "name": "authorityHash",
      "type": "bytes20"
    },
    {
      "name": "amountPerClaim",
      "type": "int"
    },
    {
      "name": "totalPool",
      "type": "int"
    },
    {
      "name": "startTimestamp",
      "type": "int"
    },
    {
      "name": "endTimestamp",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "claim",
      "inputs": [
        {
          "name": "claimerSig",
          "type": "sig"
        },
        {
          "name": "claimerPubkey",
          "type": "pubkey"
        },
        {
          "name": "claimerHash",
          "type": "bytes20"
        }
      ]
    },
    {
      "name": "pause",
      "inputs": [
        {
          "name": "authSig",
          "type": "sig"
        },
        {
          "name": "authPubkey",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "resume",
      "inputs": [
        {
          "name": "authSig",
          "type": "sig"
        },
        {
          "name": "authPubkey",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "cancel",
      "inputs": [
        {
          "name": "authSig",
          "type": "sig"
        },
        {
          "name": "authPubkey",
          "type": "pubkey"
        }
      ]
    }
  ],
  "bytecode": "OP_6 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_0 OP_UTXOTOKENCOMMITMENT OP_DUP OP_1 OP_SPLIT OP_DROP OP_BIN2NUM OP_OVER OP_1 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_DROP OP_2 OP_PICK OP_2 OP_SPLIT OP_NIP OP_8 OP_SPLIT OP_DROP OP_BIN2NUM OP_3 OP_ROLL OP_10 OP_SPLIT OP_NIP OP_8 OP_SPLIT OP_DROP OP_BIN2NUM OP_12 OP_PICK OP_HASH160 OP_14 OP_PICK OP_EQUALVERIFY OP_11 OP_ROLL OP_12 OP_ROLL OP_CHECKSIGVERIFY OP_3 OP_ROLL OP_0 OP_NUMEQUALVERIFY OP_7 OP_PICK OP_0 OP_GREATERTHAN OP_IF OP_TXLOCKTIME OP_8 OP_PICK OP_GREATERTHANOREQUAL OP_VERIFY OP_ENDIF OP_8 OP_PICK OP_0 OP_GREATERTHAN OP_IF OP_TXLOCKTIME OP_9 OP_PICK OP_LESSTHANOREQUAL OP_VERIFY OP_ENDIF OP_SWAP OP_5 OP_PICK OP_ADD OP_DUP OP_7 OP_PICK OP_LESSTHANOREQUAL OP_VERIFY OP_0 OP_OUTPUTBYTECODE 76a914 OP_12 OP_ROLL OP_CAT 88ac OP_CAT OP_EQUALVERIFY OP_2 OP_PICK OP_4 OP_AND OP_4 OP_EQUAL OP_IF OP_0 OP_OUTPUTTOKENCATEGORY OP_0 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_6 OP_PICK OP_NUMEQUALVERIFY OP_ELSE OP_0 OP_OUTPUTVALUE OP_6 OP_PICK OP_NUMEQUALVERIFY OP_ENDIF OP_SWAP OP_1ADD OP_0 OP_2 OP_PICK OP_8 OP_ROLL OP_GREATERTHANOREQUAL OP_IF OP_DROP OP_3 OP_ENDIF OP_1 OP_NUM2BIN OP_3 OP_ROLL OP_CAT OP_ROT OP_8 OP_NUM2BIN OP_CAT OP_SWAP OP_8 OP_NUM2BIN OP_CAT OP_TXLOCKTIME OP_5 OP_NUM2BIN OP_CAT 0000000000000000000000000000000000 OP_CAT OP_1 OP_OUTPUTTOKENCOMMITMENT OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENCATEGORY OP_0 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_0 OP_UTXOBYTECODE OP_EQUALVERIFY 0000000000000000000000000000000000000000000000000000000000000000 OP_EQUAL OP_NOT OP_VERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_6 OP_PICK OP_1 OP_NUMEQUAL OP_IF OP_0 OP_UTXOTOKENCOMMITMENT OP_DUP OP_1 OP_SPLIT OP_DROP OP_BIN2NUM OP_OVER OP_1 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_DROP OP_11 OP_PICK OP_HASH160 OP_5 OP_ROLL OP_EQUALVERIFY OP_9 OP_ROLL OP_10 OP_ROLL OP_CHECKSIGVERIFY OP_1 OP_AND OP_1 OP_EQUALVERIFY OP_0 OP_NUMEQUALVERIFY OP_1 OP_SWAP OP_1 OP_SPLIT OP_NIP 16 OP_SPLIT OP_DROP OP_CAT 0000000000000000000000000000000000 OP_CAT OP_0 OP_OUTPUTTOKENCOMMITMENT OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENCATEGORY OP_0 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTBYTECODE OP_0 OP_UTXOBYTECODE OP_EQUALVERIFY OP_2DROP OP_2DROP OP_2DROP OP_1 OP_ELSE OP_6 OP_PICK OP_2 OP_NUMEQUAL OP_IF OP_0 OP_UTXOTOKENCOMMITMENT OP_DUP OP_1 OP_SPLIT OP_DROP OP_BIN2NUM OP_10 OP_PICK OP_HASH160 OP_4 OP_ROLL OP_EQUALVERIFY OP_8 OP_ROLL OP_9 OP_ROLL OP_CHECKSIGVERIFY OP_1 OP_NUMEQUALVERIFY 00 OP_SWAP OP_1 OP_SPLIT OP_NIP 16 OP_SPLIT OP_DROP OP_CAT 0000000000000000000000000000000000 OP_CAT OP_0 OP_OUTPUTTOKENCOMMITMENT OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENCATEGORY OP_0 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTBYTECODE OP_0 OP_UTXOBYTECODE OP_EQUALVERIFY OP_2DROP OP_2DROP OP_2DROP OP_1 OP_ELSE OP_6 OP_ROLL OP_3 OP_NUMEQUALVERIFY OP_0 OP_UTXOTOKENCOMMITMENT OP_DUP OP_1 OP_SPLIT OP_DROP OP_BIN2NUM OP_OVER OP_1 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_DROP OP_ROT OP_2 OP_SPLIT OP_NIP OP_8 OP_SPLIT OP_DROP OP_BIN2NUM OP_10 OP_PICK OP_HASH160 OP_5 OP_PICK OP_EQUALVERIFY OP_9 OP_ROLL OP_10 OP_ROLL OP_CHECKSIGVERIFY OP_OVER OP_1 OP_AND OP_1 OP_EQUALVERIFY OP_2 OP_PICK OP_0 OP_NUMEQUAL OP_3 OP_ROLL OP_1 OP_NUMEQUAL OP_BOOLOR OP_VERIFY OP_5 OP_ROLL OP_SWAP OP_SUB OP_DUP OP_0 OP_GREATERTHAN OP_VERIFY OP_0 OP_OUTPUTBYTECODE 76a914 OP_5 OP_ROLL OP_CAT 88ac OP_CAT OP_EQUALVERIFY OP_SWAP OP_4 OP_AND OP_4 OP_EQUAL OP_IF OP_0 OP_OUTPUTTOKENCATEGORY OP_0 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_OVER OP_NUMEQUALVERIFY OP_ELSE OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_ENDIF OP_2DROP OP_2DROP OP_DROP OP_1 OP_ENDIF OP_ENDIF OP_ENDIF",
  "source": "/**\n * AirdropCovenant — Production Grade\n *\n * ENFORCEABILITY: [ENFORCEABLE-NOW]\n *\n * PURPOSE: Enforce mass token/BCH distribution campaigns.\n *          Claims are permissionless (claimer-signed).\n *          Authority only controls administrative paths (pause/resume/cancel).\n *\n * NFT COMMITMENT (40 bytes — within CashTokens 40-byte limit):\n *   [0]:     status (uint8: 0=ACTIVE, 1=PAUSED, 2=CANCELLED, 3=COMPLETED)\n *   [1]:     flags (uint8: bit0=cancelable, bit2=usesTokens)\n *   [2-9]:   total_claimed (uint64)\n *   [10-17]: claims_count (uint64)\n *   [18-22]: last_claim_timestamp (5 bytes)\n *   [23-39]: reserved (17 bytes)\n *\n * CONTRACT PARAMETERS (compiled into bytecode, immutable):\n *   vaultId        — links campaign to source vault\n *   authorityHash  — hash160(authority pubkey) used for pause/resume/cancel\n *   amountPerClaim — satoshis or FT per claim (fixed)\n *   totalPool      — total amount available\n *   startTimestamp — when claims open (0 = immediate)\n *   endTimestamp   — when claims close (0 = no expiry)\n */\n\npragma cashscript ^0.13.0;\n\ncontract AirdropCovenant(\n    bytes32 vaultId,\n    bytes20 authorityHash,\n    int amountPerClaim,\n    int totalPool,\n    int startTimestamp,\n    int endTimestamp\n) {\n    function claim(sig claimerSig, pubkey claimerPubkey, bytes20 claimerHash) {\n        bytes c = tx.inputs[0].nftCommitment;\n        int status       = int(c.split(1)[0]);\n        bytes1 flagsByte = c.split(1)[1].split(1)[0];\n        int totalClaimed = int(c.split(2)[1].split(8)[0]);\n        int claimsCount  = int(c.split(10)[1].split(8)[0]);\n\n        require(hash160(claimerPubkey) == claimerHash);\n        require(checkSig(claimerSig, claimerPubkey));\n        require(status == 0); // ACTIVE\n\n        if (startTimestamp > 0) { require(tx.locktime >= startTimestamp); }\n        if (endTimestamp > 0)   { require(tx.locktime <= endTimestamp); }\n\n        int newTotalClaimed = totalClaimed + amountPerClaim;\n        require(newTotalClaimed <= totalPool);\n\n        require(tx.outputs[0].lockingBytecode == new LockingBytecodeP2PKH(claimerHash));\n\n        if ((flagsByte & 0x04) == 0x04) {\n            require(tx.outputs[0].tokenCategory == tx.inputs[0].tokenCategory);\n            require(tx.outputs[0].tokenAmount == amountPerClaim);\n        } else {\n            require(tx.outputs[0].value == amountPerClaim);\n        }\n\n        int newClaimsCount = claimsCount + 1;\n        int newStatus = 0;\n        if (newTotalClaimed >= totalPool) { newStatus = 3; } // COMPLETED\n\n        bytes newCommitment =\n            toPaddedBytes(newStatus, 1) +\n            flagsByte +\n            toPaddedBytes(newTotalClaimed, 8) +\n            toPaddedBytes(newClaimsCount, 8) +\n            toPaddedBytes(tx.locktime, 5) +\n            0x0000000000000000000000000000000000;\n\n        require(tx.outputs[1].nftCommitment == newCommitment);\n        require(tx.outputs[1].tokenCategory == tx.inputs[0].tokenCategory);\n        require(tx.outputs[1].lockingBytecode == tx.inputs[0].lockingBytecode);\n        require(vaultId != 0x0000000000000000000000000000000000000000000000000000000000000000);\n    }\n\n    function pause(sig authSig, pubkey authPubkey) {\n        bytes c = tx.inputs[0].nftCommitment;\n        int status       = int(c.split(1)[0]);\n        bytes1 flagsByte = c.split(1)[1].split(1)[0];\n\n        require(hash160(authPubkey) == authorityHash);\n        require(checkSig(authSig, authPubkey));\n        require((flagsByte & 0x01) == 0x01); // cancelable\n        require(status == 0); // ACTIVE\n\n        bytes newCommitment =\n            0x01 +\n            c.split(1)[1].split(22)[0] +\n            0x0000000000000000000000000000000000;\n\n        require(tx.outputs[0].nftCommitment == newCommitment);\n        require(tx.outputs[0].tokenCategory == tx.inputs[0].tokenCategory);\n        require(tx.outputs[0].lockingBytecode == tx.inputs[0].lockingBytecode);\n    }\n\n    function resume(sig authSig, pubkey authPubkey) {\n        bytes c = tx.inputs[0].nftCommitment;\n        int status = int(c.split(1)[0]);\n\n        require(hash160(authPubkey) == authorityHash);\n        require(checkSig(authSig, authPubkey));\n        require(status == 1); // PAUSED\n\n        bytes newCommitment =\n            0x00 +\n            c.split(1)[1].split(22)[0] +\n            0x0000000000000000000000000000000000;\n\n        require(tx.outputs[0].nftCommitment == newCommitment);\n        require(tx.outputs[0].tokenCategory == tx.inputs[0].tokenCategory);\n        require(tx.outputs[0].lockingBytecode == tx.inputs[0].lockingBytecode);\n    }\n\n    function cancel(sig authSig, pubkey authPubkey) {\n        bytes c = tx.inputs[0].nftCommitment;\n        int status       = int(c.split(1)[0]);\n        bytes1 flagsByte = c.split(1)[1].split(1)[0];\n        int totalClaimed = int(c.split(2)[1].split(8)[0]);\n\n        require(hash160(authPubkey) == authorityHash);\n        require(checkSig(authSig, authPubkey));\n        require((flagsByte & 0x01) == 0x01); // cancelable\n        require(status == 0 || status == 1); // ACTIVE or PAUSED\n\n        int remainingPool = totalPool - totalClaimed;\n        require(remainingPool > 0);\n\n        require(tx.outputs[0].lockingBytecode == new LockingBytecodeP2PKH(authorityHash));\n\n        if ((flagsByte & 0x04) == 0x04) {\n            require(tx.outputs[0].tokenCategory == tx.inputs[0].tokenCategory);\n            require(tx.outputs[0].tokenAmount == remainingPool);\n        } else {\n            require(tx.outputs[0].value == remainingPool);\n        }\n    }\n}\n",
  "debug": {
    "bytecode": "5679009c6300cf76517f758178517f77517f755279527f77587f7581537a5a7f77587f75815c79a95e79885b7a5c7aad537a009d577900a063c55879a26968587900a063c55979a169687c557993765779a16900cd0376a9145c7a7e0288ac7e885279548454876300d100ce8800d356799d6700cc56799d687c8b005279587aa2637553685180537a7e7b58807e7c58807ec555807e1100000000000000000000000000000000007e51d28851d100ce8851cd00c7882000000000000000000000000000000000000000000000000000000000000000008791696d6d7551675679519c6300cf76517f758178517f77517f755b79a9557a88597a5a7aad51845188009d517c517f7701167f757e1100000000000000000000000000000000007e00d28800d100ce8800cd00c7886d6d6d51675679529c6300cf76517f75815a79a9547a88587a597aad519d01007c517f7701167f757e1100000000000000000000000000000000007e00d28800d100ce8800cd00c7886d6d6d5167567a539d00cf76517f758178517f77517f757b527f77587f75815a79a9557988597a5a7aad78518451885279009c537a519c9b69557a7c947600a06900cd0376a914557a7e0288ac7e887c548454876300d100ce8800d3789d6700cc789d686d6d7551686868",
    "sourceMap": "37:4:79:5;;;;;38:28:38:29;:18::44:1;39:31:39:32:0;:39::40;:31::41:1;:::44;:27::45;40::40:28:0;:35::36;:27::37:1;:::40;:47::48:0;:27::49:1;:::52;41:31:41:32:0;;:39::40;:31::41:1;:::44;:51::52:0;:31::53:1;:::56;:27::57;42:31:42:32:0;;:39::41;:31::42:1;:::45;:52::53:0;:31::54:1;:::57;:27::58;44:24:44:37:0;;:16::38:1;:42::53:0;;:8::55:1;45:25:45:35:0;;:37::50;;:8::53:1;46:16:46:22:0;;:26::27;:8::29:1;48:12:48:26:0;;:29::30;:12:::1;:32::75:0;:42::53;:57::71;;:42:::1;:34::73;:32::75;49:12:49:24:0;;:27::28;:12:::1;:32::73:0;:42::53;:57::69;;:42:::1;:34::71;:32::73;51:30:51:42:0;:45::59;;:30:::1;52:16:52:31:0;:35::44;;:16:::1;:8::46;54:27:54:28:0;:16::45:1;:49::86:0;:74::85;;:49::86:1;;;:8::88;56:13:56:22:0;;:25::29;:13:::1;:34::38:0;:12:::1;:40:59:9:0;57:31:57:32;:20::47:1;:61::62:0;:51::77:1;:12::79;58:31:58:32:0;:20::45:1;:49::63:0;;:12::65:1;59:15:61:9:0;60:31:60:32;:20::39:1;:43::57:0;;:12::59:1;59:15:61:9;63:29:63:40:0;:::44:1;64:24:64:25:0;65:12:65:27;;:31::40;;:12:::1;:42::60:0;:44::58:1;;:42::60;68:37:68:38:0;:12::39:1;69::69:21:0;;68::::1;70:26:70:41:0;:43::44;:12::45:1;68;71:26:71:40:0;:42::43;:12::44:1;68;72:26:72:37:0;:39::40;:12::41:1;68;73::73:48:0;68::::1;75:27:75:28:0;:16::43:1;:8::62;76:27:76:28:0;:16::43:1;:57::58:0;:47::73:1;:8::75;77:27:77:28:0;:16::45:1;:59::60:0;:49::77:1;:8::79;78:27:78:93:0;:16:::1;;:8::95;37:4:79:5;;;;;81::99::0;;;;;82:28:82:29;:18::44:1;83:31:83:32:0;:39::40;:31::41:1;:::44;:27::45;84::84:28:0;:35::36;:27::37:1;:::40;:47::48:0;:27::49:1;:::52;86:24:86:34:0;;:16::35:1;:39::52:0;;:8::54:1;87:25:87:32:0;;:34::44;;:8::47:1;88:29:88:33:0;:17:::1;:38::42:0;:8::44:1;89:26:89:27:0;:8::29:1;92:12:92:16:0;93::93:13;:20::21;:12::22:1;:::25;:32::34:0;:12::35:1;:::38;92;94::94:48:0;92::::1;96:27:96:28:0;:16::43:1;:8::62;97:27:97:28:0;:16::43:1;:57::58:0;:47::73:1;:8::75;98:27:98:28:0;:16::45:1;:59::60:0;:49::77:1;:8::79;81:4:99:5;;;;;101::117::0;;;;;102:28:102:29;:18::44:1;103:25:103:26:0;:33::34;:25::35:1;:::38;:21::39;105:24:105:34:0;;:16::35:1;:39::52:0;;:8::54:1;106:25:106:32:0;;:34::44;;:8::47:1;107:26:107:27:0;:8::29:1;110:12:110:16:0;111::111:13;:20::21;:12::22:1;:::25;:32::34:0;:12::35:1;:::38;110;112::112:48:0;110::::1;114:27:114:28:0;:16::43:1;:8::62;115:27:115:28:0;:16::43:1;:57::58:0;:47::73:1;:8::75;116:27:116:28:0;:16::45:1;:59::60:0;:49::77:1;:8::79;101:4:117:5;;;;;119::141::0;;;;120:28:120:29;:18::44:1;121:31:121:32:0;:39::40;:31::41:1;:::44;:27::45;122::122:28:0;:35::36;:27::37:1;:::40;:47::48:0;:27::49:1;:::52;123:31:123:32:0;:39::40;:31::41:1;:::44;:51::52:0;:31::53:1;:::56;:27::57;125:24:125:34:0;;:16::35:1;:39::52:0;;:8::54:1;126:25:126:32:0;;:34::44;;:8::47:1;127:17:127:26:0;:29::33;:17:::1;:38::42:0;:8::44:1;128:16:128:22:0;;:26::27;:16:::1;:31::37:0;;:41::42;:31:::1;:16;:8::44;130:28:130:37:0;;:40::52;:28:::1;131:16:131:29:0;:32::33;:16:::1;:8::35;133:27:133:28:0;:16::45:1;:49::88:0;:74::87;;:49::88:1;;;:8::90;135:13:135:22:0;:25::29;:13:::1;:34::38:0;:12:::1;:40:138:9:0;136:31:136:32;:20::47:1;:61::62:0;:51::77:1;:12::79;137:31:137:32:0;:20::45:1;:49::62:0;:12::64:1;138:15:140:9:0;139:31:139:32;:20::39:1;:43::56:0;:12::58:1;138:15:140:9;119:4:141:5;;;;29:0:142:1;;",
    "logs": [],
    "requires": [
      {
        "ip": 48,
        "line": 44
      },
      {
        "ip": 53,
        "line": 45
      },
      {
        "ip": 57,
        "line": 46
      },
      {
        "ip": 67,
        "line": 48
      },
      {
        "ip": 78,
        "line": 49
      },
      {
        "ip": 88,
        "line": 52
      },
      {
        "ip": 97,
        "line": 54
      },
      {
        "ip": 109,
        "line": 57
      },
      {
        "ip": 114,
        "line": 58
      },
      {
        "ip": 120,
        "line": 60
      },
      {
        "ip": 155,
        "line": 75
      },
      {
        "ip": 160,
        "line": 76
      },
      {
        "ip": 165,
        "line": 77
      },
      {
        "ip": 169,
        "line": 78
      },
      {
        "ip": 199,
        "line": 86
      },
      {
        "ip": 204,
        "line": 87
      },
      {
        "ip": 208,
        "line": 88
      },
      {
        "ip": 210,
        "line": 89
      },
      {
        "ip": 224,
        "line": 96
      },
      {
        "ip": 229,
        "line": 97
      },
      {
        "ip": 234,
        "line": 98
      },
      {
        "ip": 257,
        "line": 105
      },
      {
        "ip": 262,
        "line": 106
      },
      {
        "ip": 264,
        "line": 107
      },
      {
        "ip": 278,
        "line": 114
      },
      {
        "ip": 283,
        "line": 115
      },
      {
        "ip": 288,
        "line": 116
      },
      {
        "ip": 325,
        "line": 125
      },
      {
        "ip": 330,
        "line": 126
      },
      {
        "ip": 335,
        "line": 127
      },
      {
        "ip": 345,
        "line": 128
      },
      {
        "ip": 353,
        "line": 131
      },
      {
        "ip": 362,
        "line": 133
      },
      {
        "ip": 373,
        "line": 136
      },
      {
        "ip": 377,
        "line": 137
      },
      {
        "ip": 382,
        "line": 139
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.13.0-next.3"
  },
  "updatedAt": "2026-02-25T23:22:30.477Z"
}